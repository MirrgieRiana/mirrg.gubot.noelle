# mirrg.gubot.noelle

## 起動方法

```
cd mirrg.gubot.noelle
java -jar ../repos/mirrg.gubot.noelle-*.*.*.jar
```

または`mirrg.gubot.noelle/run.vbs`を実行（Windowsの場合）

## インストール

スタートメニューなどに入れる場合、インストーラーは無いので手動で設定する。

### Windows10

1. スタートメニューのフォルダを開き、run.vbsへのショートカットをどこかに追加する。
1. 追加したショートカットの外見をお好みで変更する。
  - `icon.ico`に起動時のものと同じアイコンファイルがあるので、これを設定するといい。
1. すべてのプログラムに表示されているはずなので、スタートメニューにD&Dしてピン止めする。

## ファイル

### 実行用ファイル

- `/mirrg.gubot.noelle`: 実行ディレクトリ
  - `data.csv`: ヒロインデータファイル
  - `*.mp3`: 各種SE
  - `icon.ico`: おまけ
  - `icon.png`: フォームアイコン用イメージ
  - `imageSelecting.png`: 領地選択画面か判断する為の画像
  - `config.properties`: フォームのいくつかのパラメータを設定できるファイル
  - `run.vbs`: Windows用起動スクリプト
  - `faces`: ヒロインのサムネイル保存フォルダ
    - `黒.png`: 背景用画像
  - `glyphs`: 経験値抽出用グリフテクスチャ

### 出力ファイル

- `/mirrg.gubot.noelle`: 実行ディレクトリ
  - `pluginx.xml`: プラグイン設定保存ファイル
  - `logs`: 統計用情報保存フォルダ
  - `screenshots`: スクリーンショット保存フォルダ

## 機能

- メニューバー
  - GUの画面を認識
    - 原理：
      - GUの画面の周り1pxには黒い枠線が引かれている
      - 全画面から全ての黒いピクセルの島を抽出
      - サイズがGUの画面と同じものをGUの画面がある位置と断定
  - スクショ：　認識しているGUの画面のスクリーンショットをとる
    - `screenshots`フォルダに格納される
  - 遭遇した領地のログをとる
    - `logs`フォルダに格納される
  - 監視チェックボックス：　監視中はCPUを喰うので、OFFにできる
    - 最小化中は常にOFF
    - <span style="color: red">OFFの場合、統計情報を取得できないので注意</span>
- 登録ボタン：　現在表示されている未知のヒロインを登録する
  - ヒロインのサムネイル画像を基にして領地の秘書を抽出しているが、
    ヒロインの画像とヒロイン名はリポジトリに含まれておらず、
    「未知」ヒロインに遭遇次第登録をすることでヒロインの取得ができるようになる。
- 検索ボタン：　指定の条件の領地が出るまで領地を飛ばす（マクロ）
  - 検索終了時に音を出すか設定可能
    - 現状ではスクショの音もここでON/OFFされる
  - いくつかの検索プラグインによる柔軟な判定
- プラグイン：　マクロの停止/進行を決めるNoelleの華
  - 領地選択画面からヒロイン情報を抽出する
  - 領地選択画面から経験値情報を抽出する
    - 原理：
      - 正規表現のコンパイラ的なものを実装
      - グリフデータと比較して文字列を抽出
  - 領地選択画面から資源情報を抽出する
  - 現在の秘書が未知かどうか判定する
  - カーソルがGUの画面から外れた時に終了する
  - 簡易的なスクリプトで条件を高度に設定する
